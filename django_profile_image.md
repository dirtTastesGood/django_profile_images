# Profile Images in Django

This guide will walk throught the steps necessary adding a `profile_image` to an instance of a user model. 

The project in this guide will be setup in a [Pipenv](https://pipenv-fork.readthedocs.io/en/latest/) environment and all commands will be issed from within the environment unless otherwise noted. Commands will be executed on a Linux terminal.

## Project Setup

Create a directory for your project and navigate into it

    $ mkdir <PROJECT_NAME>
    $ cd <PROJECT_NAME>

Create the Pipenv environment

    $ pipenv shell

Install Django

    $ pipenv install django

Start a Django project

    $ django-admin startproject <PROJECT_NAME> .

The dot after `<PROJECT_NAME>` will tell Django to start the project in the current directory.

Create `users` app

    $ python manage.py startapp users

Create `profile_images` app

    $ python manage.py startapp profile_images

In your project's `settings.py`, add `users` and `profile_images` to the list of installed apps.

    INSTALLED_APPS = [
        'django.contrib.admin',
        'django.contrib.auth',
        ...
        ...
        ...
        'users',           # add this
        'profile_images',  # add this
    ]

## Custom User Model

We will need to extend the built-in `AbstractUser` model in order to add extra fields to our `CustomUser` model. 

A guide for setting up the `CustomUser` model can be found [here](https://github.com/dirtTastesGood/simplified_guides/blob/master/custom_user_model.md)

## PIL

    import PIL


## Create ProfileImage Model
Define `get_upload_path`
    
    from users_app import CustomUserModel
    # or from django.contrib.auth import get_user_model

    def get_upload_path(instance, filename):

        extension = filename.split('.')[-1]

        upload_path = path.join(f"profile_images/{instance.email}/", f'profile_image.{extension}')
        return upload_path

    class ProfileImage(models.Model):

        owner = models.ForeignKey(CustomUserModel, on_delete='models.CASCADE', related_name='profile_image')

        image = models.ImageField(
            _("profile image"),
            default="profile_images/default.jpg",
            upload_to=get_upload_path,
        )

        def __str__(self):
            return self.image

### ProfileImage Form

    from users.models import ProfileImage

    class ProfileImageUpdateForm(forms.ModelForm):

        class Meta:
            model = ProfileImage
            fields = ['image']

### Template

Break this down into steps:

    <!-- enctype="multipart/form-data" is
    required to be able to upload the file -->
    <form method="POST" enctype="multipart/form-data"> 
        {% csrf_token %}

        <!-- The field label will be styled and used
        as the button to bring up the file select menu.
        An input field with an id of 'id_image' will
        be generated by the Django form rendering -->
        <label for="id_image">
            <p>
                Select profile image
            </p> 

            <!-- This is the original field and will
            be hidden because it looks gross and is
            difficult to customize -->
            <div id="profile-image-field">
                <!-- This will generate the input
                field with an id of 'id_image'-->
                {{ u_form.image }}
            </div>
        </label>

        <!-- Updated with JS to display the name of the file the user selects, if desired. -->
        <div id="new-image">
            No file selected
        </div>

        <!-- Button to submit the form -->
        <button type="submit">
            Update
        </button>
    </form>

